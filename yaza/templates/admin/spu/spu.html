{% extends "layout.html" %}
{% block main %}

  <div class="containers">
    <form class="form-horizontal" role="form">
      <div class="form-group">
        <label class="col-sm-2 control-label" for="name">名称</label>

        <div class="col-sm-10">
          <input type="text" name="name" id="name" value="{{ spu.name }}" class="form-control"/>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="order_id">订单号</label>

        <div class="col-sm-10">
          <input type="text" name="order_id" id="order_id" value="" class="form-control"/>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button class="btn btn-default" type="button" name="generator">生成加密的URL</button>
        </div>
      </div>
      <input name="id" type="hidden" value="{{ spu.id }}"/>
    </form>

    <div class="col-sm-offset-2 col-sm-8">
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="panel-title">
            加密的URL
          </div>
        </div>
        <div class="panel-body">
          <span id="security-url"></span>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/components/jquery/dist/jquery.min.js"></script>
  <script>
    $(function () {
      $("[name=generator]").click(function () {
        if (!$("#order_id").val()) {
          alert("订单号不能为空");
          return false;
        }
        $.ajax({"url": "{{ url_for("admin.generator_ws") }}", "type": "POST",
              "data": {"id": $("[name=id]").val(), "order_id": $("#order_id").val()},
              "beforeSend": function () {
                $("#security-url").html($("<i></i>").addClass("fa fa-spin fa-spinner"));
              }}
        ).done(function (content) {
              $("#security-url").html($("<a></a>").attr("href", content).html(content));
            });
        return true;
      });
    });
  </script>
{% endblock %}